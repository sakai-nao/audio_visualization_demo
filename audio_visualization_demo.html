<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>éŸ³ã®å¯è¦–åŒ–ãƒ‡ãƒ¢</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  
  <style>
    /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
    :root {
      --primary: #007bff;
      --primary-dark: #0056b3;
      --accent: #00acc1;
      --accent-dark: #00838f;
      --danger: #FF5733;
      --grid: rgba(0,0,0,0.08);
      --bg-light: #ffffff;
      --bg-container: #ffffff;
      --text-light: #212121;
      --border: #e0e0e0;
    }

    /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-light: #121212;
        --bg-container: #1e1e1e;
        --text-light: #e5e5e5;
        --grid: rgba(255,255,255,0.08);
        --border: #333;
      }
    }

    /* åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
      padding: 1rem;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--bg-container);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid var(--border);
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: var(--primary);
      font-weight: 700;
    }

    /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¨ãƒªã‚¢ */
    .canvas-section {
      margin-bottom: 2rem;
    }

    .canvas-section h2 {
      margin-bottom: 1rem;
      color: var(--accent);
      font-size: 1.2rem;
    }

    canvas {
      width: 100%;
      border: 2px solid var(--primary);
      border-radius: 10px;
      background: var(--bg-container);
      margin-bottom: 1rem;
    }

    #waveCanvas {
      height: 420px;
      background: var(--bg-light);
    }

    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ */
    .control-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      align-items: start;
      margin-bottom: 1rem;
    }

    .control-group {
      background: var(--bg-light);
      padding: 1.5rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      margin-bottom: 1rem; /* control-rowã¨å˜ç‹¬groupã®é–“ã®ãƒãƒ¼ã‚¸ãƒ³ */
    }

    .control-group h3 {
      margin-bottom: 1rem;
      color: var(--primary);
      font-size: 1.1rem;
    }

    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
    .slider-container {
      margin-bottom: 1rem;
    }

    .slider-container label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .slider {
      width: 100%;
      height: 8px;
      border-radius: 5px;
      background: #ddd;
      outline: none;
      appearance: none;
      transition: 0.2s;
    }

    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      border: none;
    }

    .slider-value {
      font-size: 1rem;
      font-weight: bold;
      color: var(--primary);
      margin-top: 0.5rem;
      text-align: center;
    }

    /* ãƒœã‚¿ãƒ³ */
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1rem;
    }

    button {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .primary-btn {
      background: var(--primary);
      color: white;
    }

    .primary-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .wave-btn {
      background: transparent;
      color: var(--accent);
      border: 2px solid var(--accent);
    }

    .wave-btn:hover,
    .wave-btn.active {
      background: var(--accent);
      color: white;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .controls {
        grid-template-columns: 1fr;
      }
      
      .button-group {
        flex-direction: column;
      }
    }

    /* èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ */
    .description {
      background: var(--bg-light);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      border-left: 4px solid var(--accent);
      font-size: 0.9rem;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="canvas-section">
      <h2>ã‚¢ãƒŠãƒ­ã‚°ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ã®æ¯”è¼ƒ</h2>
      <canvas id="waveCanvas"></canvas>
    </div>
    
    <div class="control-group">
      <h3>ğŸ›ï¸ å‘¨æ³¢æ•°è¨­å®š</h3>
      <div class="slider-container">
        <label for="frequencySlider">å‘¨æ³¢æ•°</label>
        <input type="range"id="frequencySlider" min="20" max="2000" value="440" step="5" class="slider">
        <div id="freqValue" class="slider-value">440 Hz</div>
      </div>
      <div class="button-group">
        <button id="playButton" class="primary-btn">ğŸ”Š å†ç”Ÿ</button>
      </div>
    </div>

    <div class="control-row">
      <div class="control-group">
        <h3>ã€° æ³¢å½¢é¸æŠ</h3>
        <div class="button-group" id="waveButtons">
          <button data-type="sine" class="wave-btn active">æ­£å¼¦æ³¢</button>
          <button data-type="square" class="wave-btn">çŸ©å½¢æ³¢</button>
          <button data-type="triangle" class="wave-btn">ä¸‰è§’æ³¢</button>
          <button data-type="sawtooth" class="wave-btn">ã®ã“ãã‚Šæ³¢</button>
        </div>
      </div>

      <div class="control-group">
        <h3>âš™ï¸ è¡¨ç¤ºè¨­å®š</h3>
        <div class="slider-container">
          <label for="samplingSlider">ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°</label>
          <input type="range" id="samplingSlider" min="100" max="5000" value="2000" step="50" class="slider">
          <div id="samplingValue" class="slider-value">2000 Hz</div>
        </div>
        <div class="slider-container">
          <label for="quantizeSlider">é‡å­åŒ–ãƒ¬ãƒ™ãƒ«</label>
          <input type="range" id="quantizeSlider" min="1" max="16" value="8" class="slider">
          <div id="quantizeValue" class="slider-value">8 æ®µéš</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ============================================================
     * ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
     * ============================================================ */
    
    // Web Audio APIé–¢é€£ã®å¤‰æ•°ã‚’æº–å‚™ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯éŸ³å£°ã®å†ç”Ÿã‚„åˆ†æã«ä½¿ã„ã¾ã™ã€‚
    const AudioContext = window.AudioContext || window.webkitAudioContext; // ãƒ–ãƒ©ã‚¦ã‚¶é–“ã®äº’æ›æ€§ã‚’è€ƒæ…®
    let audioCtx = null;      // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ã®ä¸­å¿ƒã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    let oscillator = null;    // ç‰¹å®šã®å‘¨æ³¢æ•°ã®æ³¢å½¢ï¼ˆéŸ³ï¼‰ã‚’ç”Ÿæˆã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    let gainNode = null;      // éŸ³é‡ã‚’åˆ¶å¾¡ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    let analyser = null;      // éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆä»Šå›ã¯ä½¿ã„ã¾ã›ã‚“ãŒã€å°†æ¥ã®æ‹¡å¼µç”¨ã«æ®‹ã—ã¦ã„ã¾ã™ï¼‰

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°
    let isPlaying = false;    // éŸ³ãŒå†ç”Ÿä¸­ã‹ã©ã†ã‹ã‚’è¨˜éŒ² (true: å†ç”Ÿä¸­, false: åœæ­¢ä¸­)
    let currentWave = 'sine'; // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹æ³¢å½¢ã®ç¨®é¡ ('sine', 'square', 'triangle', 'sawtooth')

    // ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°
    let quantizationLevels = 8; // é‡å­åŒ–ã®æ®µéšæ•°ã€‚åˆæœŸå€¤ã¯8æ®µéšã§ã™ã€‚

    // HTMLã®è¦ç´ ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚„ãƒœã‚¿ãƒ³ãªã©ï¼‰ã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    const elements = {
      playButton: document.getElementById('playButton'),           // å†ç”Ÿ/åœæ­¢ãƒœã‚¿ãƒ³
      freqSlider: document.getElementById('frequencySlider'),      // å‘¨æ³¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
      freqValue: document.getElementById('freqValue'),             // å‘¨æ³¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ç¾åœ¨å€¤ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€
      samplingSlider: document.getElementById('samplingSlider'),   // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
      samplingValue: document.getElementById('samplingValue'),     // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°ã®ç¾åœ¨å€¤ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€
      waveButtons: document.getElementById('waveButtons'),         // æ³¢å½¢é¸æŠãƒœã‚¿ãƒ³ã®ã‚°ãƒ«ãƒ¼ãƒ—
      waveCanvas: document.getElementById('waveCanvas'),           // æ³¢å½¢ã‚’æç”»ã™ã‚‹ã‚­ãƒ£ãƒ³ãƒã‚¹
      quantizeSlider: document.getElementById('quantizeSlider'),   // é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
      quantizeValue: document.getElementById('quantizeValue')      // é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ã®ç¾åœ¨å€¤ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€
    };

    // ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»ã™ã‚‹ãŸã‚ã®ã€Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€ã‚’å–å¾—ã—ã¾ã™ã€‚ã“ã‚Œã«æç”»å‘½ä»¤ã‚’ä¼ãˆã¾ã™ã€‚
    const waveCtx = elements.waveCanvas.getContext('2d');

    /* ============================================================
     * Web Audio API ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
     * ============================================================ */
    
    // éŸ³ã‚’å‡ºã™ãŸã‚ã®æº–å‚™ã‚’ã™ã‚‹é–¢æ•°
    function setupAudio() {
      // audioCtxãŒã¾ã ä½œã‚‰ã‚Œã¦ã„ãªã‘ã‚Œã°ã€æ–°ã—ãä½œæˆã—ã¾ã™ã€‚
      if (!audioCtx) audioCtx = new AudioContext();
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œãŒãªã„ã¨éŸ³å£°ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€å†é–‹ã•ã›ã¾ã™ã€‚
      if (audioCtx.state === 'suspended') audioCtx.resume();

      // éŸ³ã‚’ç”Ÿæˆãƒ»åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®å„ãƒãƒ¼ãƒ‰ï¼ˆéƒ¨å“ï¼‰ã‚’ä½œæˆã—ã¾ã™ã€‚
      oscillator = audioCtx.createOscillator(); // éŸ³æºï¼ˆã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰
      gainNode = audioCtx.createGain();         // éŸ³é‡ï¼ˆã‚²ã‚¤ãƒ³ï¼‰
      analyser = audioCtx.createAnalyser();     // åˆ†æï¼ˆã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ï¼‰

      // ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®è¨­å®š
      oscillator.type = currentWave; // æ³¢å½¢ã®ç¨®é¡ã‚’è¨­å®š
      oscillator.frequency.value = elements.freqSlider.value; // å‘¨æ³¢æ•°ã‚’ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã«è¨­å®š
      
      // å„ãƒãƒ¼ãƒ‰ã‚’æ¥ç¶šã—ã¾ã™ã€‚ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ -> ã‚²ã‚¤ãƒ³ -> ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ -> å‡ºåŠ›ï¼ˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ï¼‰
      oscillator.connect(gainNode);
      gainNode.connect(analyser);
      analyser.connect(audioCtx.destination);
      
      // éŸ³é‡ã‚’è¨­å®šã—ã¾ã™ï¼ˆå¤§ãã™ããªã„ã‚ˆã†ã«0.15ã«ã—ã¦ã„ã¾ã™ï¼‰
      gainNode.gain.value = 0.15;
    }

    // éŸ³ã®å†ç”Ÿã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
    function startTone() {
      setupAudio(); // ã¾ãšéŸ³ã®æº–å‚™ã‚’ã—ã¾ã™
      oscillator.start(); // éŸ³ã®å†ç”Ÿã‚’é–‹å§‹
      isPlaying = true; // å†ç”Ÿä¸­ãƒ•ãƒ©ã‚°ã‚’trueã«
      elements.playButton.textContent = 'â¹ï¸ åœæ­¢'; // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã€Œåœæ­¢ã€ã«å¤‰æ›´
    }

    // éŸ³ã®å†ç”Ÿã‚’åœæ­¢ã™ã‚‹é–¢æ•°
    function stopTone() {
      if (oscillator) {
        oscillator.stop();        // éŸ³ã‚’åœæ­¢
        oscillator.disconnect();  // ãƒãƒ¼ãƒ‰ã®æ¥ç¶šã‚’è§£é™¤ã—ã¦ãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾
      }
      isPlaying = false; // å†ç”Ÿä¸­ãƒ•ãƒ©ã‚°ã‚’falseã«
      elements.playButton.textContent = 'ğŸ”Š å†ç”Ÿ'; // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã€Œå†ç”Ÿã€ã«æˆ»ã™
    }

    /* ============================================================
     * ã‚¢ãƒŠãƒ­ã‚°ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢æç”»
     * ============================================================ */
    
    // ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã‚’å†èª¿æ•´ã™ã‚‹é–¢æ•°
    function resizeWaveCanvas() {
      const rect = elements.waveCanvas.getBoundingClientRect();
      elements.waveCanvas.width = rect.width; // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®å¹…ã‚’è¦ªè¦ç´ ã«åˆã‚ã›ã‚‹
      elements.waveCanvas.height = 420;       // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®é«˜ã•ã¯å›ºå®š
      drawWaveComparison(); // ã‚µã‚¤ã‚ºå¤‰æ›´å¾Œã«æ³¢å½¢ã‚’å†æç”»
    }

    // ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ã¨ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ã®æ¯”è¼ƒã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»ã™ã‚‹ãƒ¡ã‚¤ãƒ³ã®é–¢æ•°
    function drawWaveComparison() {
      const canvas = elements.waveCanvas;
      const ctx = waveCtx;
      
      // æç”»ã™ã‚‹å‰ã«ã€ã‚­ãƒ£ãƒ³ãƒã‚¹å…¨ä½“ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // --- æç”»ã®ãŸã‚ã®åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ---
      const amplitude = 48;      // æ³¢ã®æŒ¯å¹…ï¼ˆé«˜ã•ï¼‰
      const analogOffset = 110;  // ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ã‚’æç”»ã™ã‚‹Yæ–¹å‘ã®ä½ç½®ï¼ˆä¸Šå´ï¼‰
      const digitalOffset = 270; // ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ã‚’æç”»ã™ã‚‹Yæ–¹å‘ã®ä½ç½®ï¼ˆä¸‹å´ï¼‰

      // --- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‹ã‚‰æç”»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨ˆç®— ---
      // å‘¨æ³¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã«åŸºã¥ã„ã¦ã€ã‚­ãƒ£ãƒ³ãƒã‚¹å†…ã«è¡¨ç¤ºã™ã‚‹æ³¢ã®ã‚µã‚¤ã‚¯ãƒ«æ•°ã‚’æ±ºå®šã—ã¾ã™ã€‚
      // ã“ã‚Œã«ã‚ˆã‚Šã€å‘¨æ³¢æ•°ã‚’å¤‰ãˆã‚‹ã¨æ³¢ã®è¦‹ãŸç›®ï¼ˆå‘¨æœŸï¼‰ã‚‚å¤‰ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
      const baseFrequency = 440; // åŸºæº–ã¨ãªã‚‹å‘¨æ³¢æ•° (A4ã®éŸ³)
      const baseCycles = 4;      // åŸºæº–å‘¨æ³¢æ•°ã§è¡¨ç¤ºã™ã‚‹ã‚µã‚¤ã‚¯ãƒ«æ•°
      const currentFrequency = elements.freqSlider.value;
      const numCycles = (currentFrequency / baseFrequency) * baseCycles;

      // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°ã‹ã‚‰ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã«ä½•å€‹ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹ã‚’æç”»ã™ã‚‹ã‹ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
      const signalDuration = baseCycles / baseFrequency;      // ã‚­ãƒ£ãƒ³ãƒã‚¹ã«è¡¨ç¤ºã™ã‚‹æ™‚é–“å…¨ä½“ã®é•·ã•ï¼ˆç§’ï¼‰
      const samplingFrequency = elements.samplingSlider.value;  // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•° (Hz)
      const totalSamples = Math.floor(signalDuration * samplingFrequency); // å…¨ä½“ã®ã‚µãƒ³ãƒ—ãƒ«æ•°
      const sampleIntervalPx = totalSamples > 1 ? canvas.width / (totalSamples - 1) : canvas.width; // ã‚µãƒ³ãƒ—ãƒ«é–“ã®ãƒ”ã‚¯ã‚»ãƒ«é–“éš”

      // --- èƒŒæ™¯ã®æç”» ---
      // èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰ã‚’æç”»ã—ã¾ã™ã€‚
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid') || 'rgba(0,0,0,0.1)';
      ctx.lineWidth = 1;
      
      // é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ã‚’ç¤ºã™æ°´å¹³ç·šã‚’ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ã‚¨ãƒªã‚¢ã«æç”»ã—ã¾ã™ã€‚
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#FF5733';
      ctx.lineWidth = 1;
      for (let i = 0; i <= quantizationLevels; i++) {
        const y = digitalOffset - amplitude + (i / quantizationLevels) * (amplitude * 2);
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
      
      // ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ã¨ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ã‚¨ãƒªã‚¢ã®çœŸã‚“ä¸­ã«ä¸­å¿ƒç·šã‚’æç”»ã—ã¾ã™ã€‚
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#00acc1';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(0, analogOffset);
      ctx.lineTo(canvas.width, analogOffset);
      ctx.moveTo(0, digitalOffset);
      ctx.lineTo(canvas.width, digitalOffset);
      ctx.stroke();

      // --- å‡¡ä¾‹ï¼ˆèª¬æ˜ï¼‰ã®æç”» ---
      // === å·¦ä¸Šï¼šã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ï¼ˆé€£ç¶šï¼‰å‡¡ä¾‹ ===
      ctx.save(); // ç¾åœ¨ã®æç”»ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿å­˜
      ctx.font = 'bold 16px Roboto';
      const analogLabel = 'ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ï¼ˆé€£ç¶šï¼‰';
      const analogLabelWidth = ctx.measureText(analogLabel).width;
      const analogLegendW = 12 + 20 + 8 + analogLabelWidth + 12; // ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° + ç·š + ã‚®ãƒ£ãƒƒãƒ— + ãƒ©ãƒ™ãƒ« + ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
      const analogLegendH = 38;
      ctx.globalAlpha = 0.85; // å°‘ã—é€æ˜ã«ã™ã‚‹
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg-container');
      ctx.beginPath();
      ctx.moveTo(12, 12 + 6);
      ctx.arcTo(12, 12, 12 + analogLegendW, 12, 12);
      ctx.arcTo(12 + analogLegendW, 12, 12 + analogLegendW, 12 + analogLegendH, 12);
      ctx.arcTo(12 + analogLegendW, 12 + analogLegendH, 12, 12 + analogLegendH, 12);
      ctx.arcTo(12, 12 + analogLegendH, 12, 12, 12);
      ctx.closePath();
      ctx.fill();
      ctx.globalAlpha = 1.0; // é€æ˜åº¦ã‚’æˆ»ã™
      // ç·šã®å‡¡ä¾‹
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary') || '#007bff';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(12 + 12, 30);
      ctx.lineTo(12 + 12 + 20, 30);
      ctx.stroke();
      // ãƒ†ã‚­ã‚¹ãƒˆ
      ctx.font = 'bold 16px Roboto';
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary') || '#007bff';
      ctx.fillText(analogLabel, 12 + 12 + 20 + 8, 36);
      ctx.restore(); // ä¿å­˜ã—ãŸæç”»ã‚¹ã‚¿ã‚¤ãƒ«ã«æˆ»ã™

      // === å·¦ä¸‹ï¼šãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ï¼ˆé›¢æ•£ï¼‰å‡¡ä¾‹ ===
      ctx.save();
      ctx.font = 'bold 16px Roboto';
      const digitalLabel = 'ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ï¼ˆé›¢æ•£ï¼‰';
      const digitalLabelWidth = ctx.measureText(digitalLabel).width;
      const digitalLegendW = 12 + 20 + 8 + digitalLabelWidth + 12; // ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° + ç·š + ã‚®ãƒ£ãƒƒãƒ— + ãƒ©ãƒ™ãƒ« + ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
      const digitalLegendH = 32;
      const legendBottom = canvas.height - 50;
      const legendRight = 12;
      ctx.globalAlpha = 0.85;
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg-container');
      ctx.beginPath();
      ctx.moveTo(legendRight, legendBottom + 6);
      ctx.arcTo(legendRight, legendBottom, legendRight + digitalLegendW, legendBottom, 12);
      ctx.arcTo(legendRight + digitalLegendW, legendBottom, legendRight + digitalLegendW, legendBottom + digitalLegendH, 12);
      ctx.arcTo(legendRight + digitalLegendW, legendBottom + digitalLegendH, legendRight, legendBottom + digitalLegendH, 12);
      ctx.arcTo(legendRight, legendBottom + digitalLegendH, legendRight, legendBottom, 12);
      ctx.closePath();
      ctx.fill();
      ctx.globalAlpha = 1.0;
      // ç·šã®å‡¡ä¾‹
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#FF5733';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(legendRight + 12, legendBottom + 20);
      ctx.lineTo(legendRight + 12 + 20, legendBottom + 20);
      ctx.stroke();
      // ãƒ†ã‚­ã‚¹ãƒˆ
      ctx.font = 'bold 16px Roboto';
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#FF5733';
      ctx.fillText(digitalLabel, legendRight + 12 + 20 + 8, legendBottom + 26);
      ctx.restore();

      // === å³ä¸‹ï¼šã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹ãƒ»é‡å­åŒ–ãƒ¬ãƒ™ãƒ«èª¬æ˜ ===
      ctx.save();
      ctx.font = '12px Roboto';
      const desc1 = 'ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹';
      const desc2 = 'é‡å­åŒ–ãƒ¬ãƒ™ãƒ«';
      const desc1Width = ctx.measureText(desc1).width;
      const desc2Width = ctx.measureText(desc2).width;
      const descW = Math.max(desc1Width, desc2Width) + 40;
      const descH = 60;
      const descBottomAdjusted = canvas.height - descH - 12;
      const descRight = canvas.width - descW - 12;

      ctx.globalAlpha = 0.85;
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg-container');
      ctx.beginPath();
      const r_br = 12;
      ctx.moveTo(descRight + r_br, descBottomAdjusted);
      ctx.arcTo(descRight + descW, descBottomAdjusted,   descRight + descW, descBottomAdjusted + descH, r_br);
      ctx.arcTo(descRight + descW, descBottomAdjusted + descH, descRight, descBottomAdjusted + descH, r_br);
      ctx.arcTo(descRight, descBottomAdjusted + descH, descRight, descBottomAdjusted, r_br);
      ctx.arcTo(descRight, descBottomAdjusted, descRight + descW, descBottomAdjusted, r_br);
      ctx.closePath();
      ctx.fill();
      ctx.globalAlpha = 1.0;
      
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-light');
      
      // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰
      ctx.beginPath();
      ctx.arc(descRight + 16, descBottomAdjusted + 20, 7, 0, 2 * Math.PI);
      ctx.fillStyle = '#FF6B35';
      ctx.fill();
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-light');
      ctx.fillText(desc1, descRight + 32, descBottomAdjusted + 24);
      
      // é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#FF5733';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(descRight + 10, descBottomAdjusted + 42);
      ctx.lineTo(descRight + 26, descBottomAdjusted + 42);
      ctx.stroke();
      ctx.fillText(desc2, descRight + 32, descBottomAdjusted + 46);
      ctx.restore();

      // === å³ä¸Šï¼šç¾åœ¨ã®è¨­å®šæƒ…å ±ã‚’è¡¨ç¤º ===
      ctx.save();
      const samplingInfo1 = `ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°: ${samplingFrequency} Hz`;
      const samplingInfo2 = `é‡å­åŒ–ãƒ¬ãƒ™ãƒ«: ${quantizationLevels}æ®µéš`;
      ctx.font = '12px Roboto';
      ctx.textAlign = 'right';
      
      // ãƒ†ã‚­ã‚¹ãƒˆã®é•·ã•ã«åˆã‚ã›ã¦ãƒœãƒƒã‚¯ã‚¹ã®å¹…ã‚’å‹•çš„ã«å¤‰æ›´
      const infoWidth = Math.max(ctx.measureText(samplingInfo1).width, ctx.measureText(samplingInfo2).width);
      const boxWidth = infoWidth + 24;
      const boxHeight = 52;
      const boxX = canvas.width - boxWidth - 12;
      const boxY = 12;

      ctx.globalAlpha = 0.85;
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg-container');
      
      // è§’ä¸¸ã®å››è§’å½¢ã‚’æç”»
      ctx.beginPath();
      const r_tr = 8;
      ctx.moveTo(boxX + r_tr, boxY);
      ctx.arcTo(boxX + boxWidth, boxY,   boxX + boxWidth, boxY + boxHeight, r_tr);
      ctx.arcTo(boxX + boxWidth, boxY + boxHeight, boxX, boxY + boxHeight, r_tr);
      ctx.arcTo(boxX, boxY + boxHeight, boxX, boxY, r_tr);
      ctx.arcTo(boxX, boxY, boxX + boxWidth, boxY, r_tr);
      ctx.closePath();
      ctx.fill();

      // ãƒ†ã‚­ã‚¹ãƒˆã‚’æç”»
      ctx.globalAlpha = 1.0;
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-light');
      ctx.fillText(samplingInfo1, boxX + boxWidth - 12, boxY + 20);
      ctx.fillText(samplingInfo2, boxX + boxWidth - 12, boxY + 40);
      ctx.textAlign = 'left';
      ctx.restore();


      // --- ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ã®æç”» ---
      ctx.beginPath();
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary') || '#007bff';
      ctx.lineWidth = 3;
      
      // forãƒ«ãƒ¼ãƒ—ã‚’ä½¿ã£ã¦ã‚­ãƒ£ãƒ³ãƒã‚¹ã®å·¦ç«¯ã‹ã‚‰å³ç«¯ã¾ã§1ãƒ”ã‚¯ã‚»ãƒ«ãšã¤ç·šã‚’æç”»
      for (let x = 0; x < canvas.width; x++) {
        // ç¾åœ¨ã®xåº§æ¨™ã«å¯¾å¿œã™ã‚‹æ³¢ã®è§’åº¦ã‚’è¨ˆç®—
        const angle = (x / canvas.width) * numCycles * 2 * Math.PI;
        let yValue; // æ³¢ã®Yåº§æ¨™(-1ã‹ã‚‰1ã®ç¯„å›²)
        
        // é¸æŠã•ã‚Œã¦ã„ã‚‹æ³¢å½¢ã®ç¨®é¡ã«å¿œã˜ã¦ã€yã®å€¤ã‚’è¨ˆç®—
        switch (currentWave) {
          case 'sine':
            yValue = Math.sin(angle);
            break;
          case 'square':
            yValue = Math.sign(Math.sin(angle));
            break;
          case 'triangle':
            yValue = (2 / Math.PI) * Math.asin(Math.sin(angle));
            break;
          case 'sawtooth':
            yValue = 2 * (angle / (2 * Math.PI) - Math.floor(angle / (2 * Math.PI) + 0.5));
            break;
          default:
            yValue = Math.sin(angle);
        }
        
        // è¨ˆç®—ã—ãŸyValueã‚’ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã®å®Ÿéš›ã®Yåº§æ¨™ã«å¤‰æ›
        const y = yValue * amplitude + analogOffset;
        // æœ€åˆã®ç‚¹ã¯moveToã§å§‹ç‚¹ã‚’è¨­å®šã€ãã‚Œä»¥é™ã¯lineToã§ç·šã‚’çµã¶
        if (x === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke(); // æœ€å¾Œã«ç·šã‚’æç”»

      // --- ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã®å‡¦ç†ã¨æç”» ---
      // 1. ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°: ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ã‹ã‚‰ä¸€å®šé–“éš”ã§ç‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const samplePoints = [];
      for (let i = 0; i < totalSamples; i++) {
        const x = i * sampleIntervalPx; // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹ã®Xåº§æ¨™
        const angle = (x / canvas.width) * numCycles * 2 * Math.PI;
        let yValue;
        
        // å†åº¦ã€æ³¢å½¢ã®å€¤ã‚’è¨ˆç®—ï¼ˆã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ã®æç”»ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
        switch (currentWave) {
          case 'sine': yValue = Math.sin(angle); break;
          case 'square': yValue = Math.sign(Math.sin(angle)); break;
          case 'triangle': yValue = (2 / Math.PI) * Math.asin(Math.sin(angle)); break;
          case 'sawtooth': yValue = 2 * (angle / (2 * Math.PI) - Math.floor(angle / (2 * Math.PI) + 0.5)); break;
          default: yValue = Math.sin(angle);
        }
        
        const analogY = yValue * amplitude + analogOffset; // ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ä¸Šã§ã®Yåº§æ¨™
        // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ãŸç‚¹ã®æƒ…å ±ã‚’é…åˆ—ã«ä¿å­˜
        samplePoints.push({ x: x, analogY: analogY, originalValue: yValue });
      }

      // 2. ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹ã®å¯è¦–åŒ–
      samplePoints.forEach(point => {
        // ã‚¢ãƒŠãƒ­ã‚°æ³¢å½¢ã®ä¸Šã«ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ã®ä¸¸ï¼‰ã‚’æç”»
        ctx.beginPath();
        ctx.fillStyle = '#FF6B35';
        ctx.arc(point.x, point.analogY, 4, 0, 2 * Math.PI);
        ctx.fill();
        
        // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹ã‹ã‚‰ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ã‚¨ãƒªã‚¢ã¾ã§ç‚¹ç·šã‚’å¼•ã
        ctx.beginPath();
        ctx.strokeStyle = '#FF6B35';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]); // ç‚¹ç·šã‚¹ã‚¿ã‚¤ãƒ«ã«è¨­å®š
        ctx.moveTo(point.x, point.analogY);
        ctx.lineTo(point.x, digitalOffset + amplitude);
        ctx.stroke();
        ctx.setLineDash([]); // ç·šã‚¹ã‚¿ã‚¤ãƒ«ã‚’å…ƒã«æˆ»ã™
      });

      // 3. é‡å­åŒ–ã¨ãƒ‡ã‚¸ã‚¿ãƒ«æ³¢å½¢ã®æç”»
      if (samplePoints.length > 1) {
        ctx.beginPath();
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#FF5733';
        ctx.lineWidth = 3;
        for (let i = 0; i < samplePoints.length; i++) {
          const point = samplePoints[i];
          // é‡å­åŒ–: ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ãŸå€¤ï¼ˆ-1ã€œ1ï¼‰ã‚’ã€è¨­å®šã•ã‚ŒãŸæ®µéšæ•°ã®ã„ãšã‚Œã‹ã«å½“ã¦ã¯ã‚ã‚‹
          const quantizedLevel = Math.round(((point.originalValue + 1) / 2) * quantizationLevels);
          const clampedLevel = Math.max(0, Math.min(quantizationLevels, quantizedLevel)); // å¿µã®ãŸã‚ç¯„å›²å†…ã«åã‚ã‚‹
          const quantizedY = digitalOffset - amplitude + (clampedLevel / quantizationLevels) * (amplitude * 2);
          
          // é‡å­åŒ–ã•ã‚ŒãŸç‚¹åŒå£«ã‚’ç›´ç·šã§çµã¶ï¼ˆãƒ›ãƒ¼ãƒ«ãƒ‰å‡¦ç†ï¼‰
          if (i === 0) {
            ctx.moveTo(point.x, quantizedY);
          } else {
            ctx.lineTo(point.x, quantizedY);
          }
        }
        ctx.stroke();

        // é‡å­åŒ–ã•ã‚ŒãŸå¾Œã®ç‚¹ï¼ˆèµ¤ã„ä¸¸ï¼‰ã‚’æç”»
        for (let i = 0; i < samplePoints.length; i++) {
          const point = samplePoints[i];
          const quantizedLevel = Math.round(((point.originalValue + 1) / 2) * quantizationLevels);
          const clampedLevel = Math.max(0, Math.min(quantizationLevels, quantizedLevel));
          const quantizedY = digitalOffset - amplitude + (clampedLevel / quantizationLevels) * (amplitude * 2);
          ctx.beginPath();
          ctx.arc(point.x, quantizedY, 5, 0, 2 * Math.PI);
          ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--danger') || '#FF5733';
          ctx.fill();
        }
      }
    }

    /* ============================================================
     * ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
     * ============================================================ */
    
    // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateSamplingFrequencyLabel(val) {
      elements.samplingValue.textContent = `${val} Hz`;
    }

    // å†ç”Ÿãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®å‡¦ç†
    elements.playButton.addEventListener('click', () => {
      // isPlayingãŒtrueãªã‚‰åœæ­¢ã€falseãªã‚‰é–‹å§‹
      isPlaying ? stopTone() : startTone();
    });

    // å‘¨æ³¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒæ“ä½œã•ã‚ŒãŸã¨ãã®å‡¦ç†
    elements.freqSlider.addEventListener('input', (e) => {
      const val = e.target.value;
      elements.freqValue.textContent = `${val} Hz`; // ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
      if (oscillator) {
        // å†ç”Ÿä¸­ã§ã‚ã‚Œã°ã€éŸ³ã®å‘¨æ³¢æ•°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¤‰æ›´
        oscillator.frequency.setValueAtTime(val, audioCtx.currentTime);
      }
      drawWaveComparison(); // æ³¢å½¢ã‚’å†æç”»
    });

    // ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒæ“ä½œã•ã‚ŒãŸã¨ãã®å‡¦ç†
    elements.samplingSlider.addEventListener('input', (e) => {
      const val = parseInt(e.target.value);
      updateSamplingFrequencyLabel(val); // ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
      drawWaveComparison(); // æ³¢å½¢ã‚’å†æç”»
    });

    // æ³¢å½¢é¸æŠãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®å‡¦ç†
    elements.waveButtons.addEventListener('click', (e) => {
      const type = e.target.dataset.type; // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®ç¨®é¡ã‚’å–å¾—
      if (!type) return; // ãƒœã‚¿ãƒ³ä»¥å¤–ã®å ´æ‰€ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã¯ä½•ã‚‚ã—ãªã„
      
      currentWave = type; // ç¾åœ¨ã®æ³¢å½¢ã‚¿ã‚¤ãƒ—ã‚’æ›´æ–°
      
      // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‹ã‚‰'active'ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
      elements.waveButtons.querySelectorAll('button').forEach(btn => 
        btn.classList.remove('active')
      );
      // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«'active'ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
      e.target.classList.add('active');
      
      drawWaveComparison(); // æ³¢å½¢ã‚’å†æç”»
      if (oscillator) oscillator.type = currentWave; // å†ç”Ÿä¸­ã§ã‚ã‚Œã°ã€éŸ³ã®æ³¢å½¢ã‚‚å¤‰æ›´
    });

    // é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒæ“ä½œã•ã‚ŒãŸã¨ãã®å‡¦ç†
    elements.quantizeSlider.addEventListener('input', (e) => {
      quantizationLevels = parseInt(e.target.value); // é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ã‚’æ›´æ–°
      elements.quantizeValue.textContent = `${quantizationLevels} æ®µéš`; // ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
      drawWaveComparison(); // æ³¢å½¢ã‚’å†æç”»
    });

    // ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒãƒªã‚µã‚¤ã‚ºã•ã‚ŒãŸã¨ãã®å‡¦ç†
    window.addEventListener('resize', () => {
      resizeWaveCanvas(); // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’èª¿æ•´ã—ã¦å†æç”»
    });

    /* ============================================================
     * åˆæœŸåŒ–
     * ============================================================ */
    
    // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã«æœ€åˆã«å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°
    function init() {
      // åˆæœŸçŠ¶æ…‹ã§ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’æç”»
      resizeWaveCanvas();
      
      // å„ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®åˆæœŸå€¤ã‚’ãƒ©ãƒ™ãƒ«ã«è¡¨ç¤º
      elements.freqValue.textContent = `${elements.freqSlider.value} Hz`;
      updateSamplingFrequencyLabel(parseInt(elements.samplingSlider.value));
      quantizationLevels = parseInt(elements.quantizeSlider.value);
      elements.quantizeValue.textContent = `${quantizationLevels} æ®µéš`;

      // æœ€åˆã®æ³¢å½¢ã‚’æç”»
      drawWaveComparison();
    }

    // åˆæœŸåŒ–é–¢æ•°ã‚’å®Ÿè¡Œ
    init();

  </script>
</body>
</html>
